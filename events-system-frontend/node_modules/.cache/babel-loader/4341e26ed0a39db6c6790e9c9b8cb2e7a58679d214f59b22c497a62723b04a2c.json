{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useLocation,useNavigate}from'react-router-dom';import'./MpesaPaymentForm.css';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const MpesaPaymentForm=()=>{const location=useLocation();const navigate=useNavigate();const{event}=location.state||{};const[ticketQuantity,setTicketQuantity]=useState(1);const[totalPrice,setTotalPrice]=useState(event?event.event_price:0);const[phoneNumber,setPhoneNumber]=useState('');const[pin,setPin]=useState('');const[errorMessage,setErrorMessage]=useState('');useEffect(()=>{if(event){setTotalPrice(event.event_price*ticketQuantity);}},[ticketQuantity,event]);const handleQuantityChange=increment=>{setTicketQuantity(prevQuantity=>{if(prevQuantity+increment>=1){return prevQuantity+increment;}return 1;});};const validatePhoneNumber=phoneNumber=>{const phonePattern=/^(84|85)\\d{7}$/;return phonePattern.test(phoneNumber);};const handleSubmit=async e=>{e.preventDefault();setErrorMessage('');if(!validatePhoneNumber(phoneNumber)){setErrorMessage('Please enter a valid M-Pesa phone number starting with 84 or 85 and containing 9 digits.');return;}if(!pin){setErrorMessage('Please provide a valid pin.');return;}try{const response=await fetch('/simulate-mpesa-payment',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({phone_number:phoneNumber,amount:totalPrice,event_id:event.event_id,tickets_purchased:ticketQuantity})});const data=await response.json();if(data.status==='Success'){alert('Payment successful!');navigate('/landing');}else{setErrorMessage('Payment failed. Please try again.');}}catch(error){setErrorMessage('An error occurred during payment. Please try again.');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"mpesa-payment-container\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Pay with M-Pesa for \",event===null||event===void 0?void 0:event.event_name]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"mpesa-payment-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Price (per ticket):\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:`$${event===null||event===void 0?void 0:event.event_price}`,disabled:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Quantity:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"quantity-input\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>handleQuantityChange(-1),children:\"\\u2212\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:ticketQuantity,readOnly:true}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>handleQuantityChange(1),children:\"+\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Total Price:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:`$${totalPrice.toFixed(2)}`,disabled:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Phone Number:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",value:phoneNumber,onChange:e=>setPhoneNumber(e.target.value),required:true,placeholder:\"Enter phone number (e.g., 841234567)\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Pin:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:pin,onChange:e=>setPin(e.target.value),required:true})]}),errorMessage&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:errorMessage}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Pay Now\"})]})]});};export default MpesaPaymentForm;","map":{"version":3,"names":["React","useState","useEffect","useLocation","useNavigate","jsxs","_jsxs","jsx","_jsx","MpesaPaymentForm","location","navigate","event","state","ticketQuantity","setTicketQuantity","totalPrice","setTotalPrice","event_price","phoneNumber","setPhoneNumber","pin","setPin","errorMessage","setErrorMessage","handleQuantityChange","increment","prevQuantity","validatePhoneNumber","phonePattern","test","handleSubmit","e","preventDefault","response","fetch","method","headers","body","JSON","stringify","phone_number","amount","event_id","tickets_purchased","data","json","status","alert","error","className","children","event_name","onSubmit","type","value","disabled","onClick","readOnly","toFixed","onChange","target","required","placeholder"],"sources":["C:/Users/Rindella Nhavoto/Desktop/ProjectsVSC/SWEproject/events-system-frontend/src/components/MpesaPaymentForm.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport './MpesaPaymentForm.css';\r\n\r\nconst MpesaPaymentForm = () => {\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { event } = location.state || {};\r\n\r\n  const [ticketQuantity, setTicketQuantity] = useState(1);\r\n  const [totalPrice, setTotalPrice] = useState(event ? event.event_price : 0);\r\n  const [phoneNumber, setPhoneNumber] = useState('');\r\n  const [pin, setPin] = useState('');\r\n  const [errorMessage, setErrorMessage] = useState('');\r\n\r\n  useEffect(() => {\r\n    if (event) {\r\n      setTotalPrice(event.event_price * ticketQuantity);\r\n    }\r\n  }, [ticketQuantity, event]);\r\n\r\n  const handleQuantityChange = (increment) => {\r\n    setTicketQuantity((prevQuantity) => {\r\n      if (prevQuantity + increment >= 1) {\r\n        return prevQuantity + increment;\r\n      }\r\n      return 1; \r\n    });\r\n  };\r\n\r\n  const validatePhoneNumber = (phoneNumber) => {\r\n    const phonePattern = /^(84|85)\\d{7}$/;\r\n    return phonePattern.test(phoneNumber);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setErrorMessage(''); \r\n\r\n    if (!validatePhoneNumber(phoneNumber)) {\r\n      setErrorMessage('Please enter a valid M-Pesa phone number starting with 84 or 85 and containing 9 digits.');\r\n      return;\r\n    }\r\n\r\n    if (!pin) {\r\n      setErrorMessage('Please provide a valid pin.');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch('/simulate-mpesa-payment', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          phone_number: phoneNumber,\r\n          amount: totalPrice,\r\n          event_id: event.event_id,\r\n          tickets_purchased: ticketQuantity,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (data.status === 'Success') {\r\n        alert('Payment successful!');\r\n        navigate('/landing');\r\n      } else {\r\n        setErrorMessage('Payment failed. Please try again.');\r\n      }\r\n    } catch (error) {\r\n      setErrorMessage('An error occurred during payment. Please try again.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"mpesa-payment-container\">\r\n      <h2>Pay with M-Pesa for {event?.event_name}</h2>\r\n      <form onSubmit={handleSubmit} className=\"mpesa-payment-form\">\r\n        <div className=\"form-group\">\r\n          <label>Price (per ticket):</label>\r\n          <input type=\"text\" value={`$${event?.event_price}`} disabled />\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>Quantity:</label>\r\n          <div className=\"quantity-input\">\r\n            <button type=\"button\" onClick={() => handleQuantityChange(-1)}>&minus;</button>\r\n            <input type=\"number\" value={ticketQuantity} readOnly />\r\n            <button type=\"button\" onClick={() => handleQuantityChange(1)}>&#43;</button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>Total Price:</label>\r\n          <input type=\"text\" value={`$${totalPrice.toFixed(2)}`} disabled />\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>Phone Number:</label>\r\n          <input\r\n            type=\"tel\"\r\n            value={phoneNumber}\r\n            onChange={(e) => setPhoneNumber(e.target.value)}\r\n            required\r\n            placeholder=\"Enter phone number (e.g., 841234567)\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>Pin:</label>\r\n          <input\r\n            type=\"password\"\r\n            value={pin}\r\n            onChange={(e) => setPin(e.target.value)}\r\n            required\r\n          />\r\n        </div>\r\n\r\n        {errorMessage && <div className=\"error-message\">{errorMessage}</div>}\r\n\r\n        <button type=\"submit\">Pay Now</button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MpesaPaymentForm;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}