{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useLocation,useNavigate}from'react-router-dom';import'./MpesaPaymentForm.css';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const MpesaPaymentForm=()=>{const location=useLocation();const navigate=useNavigate();const{event}=location.state||{};const[ticketQuantity,setTicketQuantity]=useState(1);// Default quantity is 1\nconst[totalPrice,setTotalPrice]=useState(event?event.event_price:0);const[phoneNumber,setPhoneNumber]=useState('');const[pin,setPin]=useState('');const[errorMessage,setErrorMessage]=useState('');useEffect(()=>{if(event){setTotalPrice(event.event_price*ticketQuantity);}},[ticketQuantity,event]);const handleQuantityChange=increment=>{setTicketQuantity(prevQuantity=>{if(prevQuantity+increment>=1){return prevQuantity+increment;}return 1;// Minimum quantity of 1\n});};const handleSubmit=async e=>{e.preventDefault();if(!phoneNumber||!pin){setErrorMessage('Please provide a valid phone number and pin.');return;}try{// Simulate Mpesa Payment API call\nconst response=await fetch('/simulate-mpesa-payment',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({phone_number:phoneNumber,amount:totalPrice,event_id:event.event_id})});const data=await response.json();if(data.status==='Success'){alert('Payment successful!');navigate('/');// Navigate back to landing page or another confirmation page\n}else{setErrorMessage('Payment failed. Please try again.');}}catch(error){setErrorMessage('An error occurred during payment. Please try again.');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"mpesa-payment-container\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Pay with M-Pesa for \",event===null||event===void 0?void 0:event.event_name]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"mpesa-payment-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Price (per ticket):\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:`$${event===null||event===void 0?void 0:event.event_price}`,disabled:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Quantity:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"quantity-input\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>handleQuantityChange(-1),children:\"\\u2212\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:ticketQuantity,readOnly:true}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>handleQuantityChange(1),children:\"+\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Total Price:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:`$${totalPrice.toFixed(2)}`,disabled:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Phone Number:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",value:phoneNumber,onChange:e=>setPhoneNumber(e.target.value),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Pin:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:pin,onChange:e=>setPin(e.target.value),required:true})]}),errorMessage&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:errorMessage}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Pay Now\"})]})]});};export default MpesaPaymentForm;","map":{"version":3,"names":["React","useState","useEffect","useLocation","useNavigate","jsxs","_jsxs","jsx","_jsx","MpesaPaymentForm","location","navigate","event","state","ticketQuantity","setTicketQuantity","totalPrice","setTotalPrice","event_price","phoneNumber","setPhoneNumber","pin","setPin","errorMessage","setErrorMessage","handleQuantityChange","increment","prevQuantity","handleSubmit","e","preventDefault","response","fetch","method","headers","body","JSON","stringify","phone_number","amount","event_id","data","json","status","alert","error","className","children","event_name","onSubmit","type","value","disabled","onClick","readOnly","toFixed","onChange","target","required"],"sources":["C:/Users/Rindella Nhavoto/Desktop/ProjectsVSC/SWEproject/events-system-frontend/src/components/MpesaPaymentForm.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport './MpesaPaymentForm.css';\r\n\r\nconst MpesaPaymentForm = () => {\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { event } = location.state || {};\r\n\r\n  const [ticketQuantity, setTicketQuantity] = useState(1); // Default quantity is 1\r\n  const [totalPrice, setTotalPrice] = useState(event ? event.event_price : 0);\r\n  const [phoneNumber, setPhoneNumber] = useState('');\r\n  const [pin, setPin] = useState('');\r\n  const [errorMessage, setErrorMessage] = useState('');\r\n\r\n  useEffect(() => {\r\n    if (event) {\r\n      setTotalPrice(event.event_price * ticketQuantity);\r\n    }\r\n  }, [ticketQuantity, event]);\r\n\r\n  const handleQuantityChange = (increment) => {\r\n    setTicketQuantity((prevQuantity) => {\r\n      if (prevQuantity + increment >= 1) {\r\n        return prevQuantity + increment;\r\n      }\r\n      return 1; // Minimum quantity of 1\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!phoneNumber || !pin) {\r\n      setErrorMessage('Please provide a valid phone number and pin.');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Simulate Mpesa Payment API call\r\n      const response = await fetch('/simulate-mpesa-payment', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          phone_number: phoneNumber,\r\n          amount: totalPrice,\r\n          event_id: event.event_id,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (data.status === 'Success') {\r\n        alert('Payment successful!');\r\n        navigate('/'); // Navigate back to landing page or another confirmation page\r\n      } else {\r\n        setErrorMessage('Payment failed. Please try again.');\r\n      }\r\n    } catch (error) {\r\n      setErrorMessage('An error occurred during payment. Please try again.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"mpesa-payment-container\">\r\n      <h2>Pay with M-Pesa for {event?.event_name}</h2>\r\n      <form onSubmit={handleSubmit} className=\"mpesa-payment-form\">\r\n        <div className=\"form-group\">\r\n          <label>Price (per ticket):</label>\r\n          <input type=\"text\" value={`$${event?.event_price}`} disabled />\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>Quantity:</label>\r\n          <div className=\"quantity-input\">\r\n            <button type=\"button\" onClick={() => handleQuantityChange(-1)}>&minus;</button>\r\n            <input type=\"number\" value={ticketQuantity} readOnly />\r\n            <button type=\"button\" onClick={() => handleQuantityChange(1)}>&#43;</button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>Total Price:</label>\r\n          <input type=\"text\" value={`$${totalPrice.toFixed(2)}`} disabled />\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>Phone Number:</label>\r\n          <input\r\n            type=\"tel\"\r\n            value={phoneNumber}\r\n            onChange={(e) => setPhoneNumber(e.target.value)}\r\n            required\r\n          />\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>Pin:</label>\r\n          <input\r\n            type=\"password\"\r\n            value={pin}\r\n            onChange={(e) => setPin(e.target.value)}\r\n            required\r\n          />\r\n        </div>\r\n\r\n        {errorMessage && <div className=\"error-message\">{errorMessage}</div>}\r\n\r\n        <button type=\"submit\">Pay Now</button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MpesaPaymentForm;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}